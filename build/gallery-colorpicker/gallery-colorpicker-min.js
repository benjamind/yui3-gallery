YUI.add("gallery-colorpicker",function(D){var C={rgbToHSL:function(E,I,K){E/=255;I/=255;K/=255;var L=Math.max(E,I,K),G=Math.min(E,I,K),H,M,F=(L+G)/2,J;if(L===G){H=M=0;}else{J=L-G;M=F>0.5?J/(2-L-G):J/(L+G);switch(L){case E:H=(I-K)/J+(I<K?6:0);break;case I:H=(K-E)/J+2;break;case K:H=(E-I)/J+4;break;}H/=6;}return{h:H,s:M,l:F};},_hue2rgb:function(G,F,E){if(E<0){E+=1;}if(E>1){E-=1;}if(E<1/6){return G+(F-G)*6*E;}if(E<1/2){return F;}if(E<2/3){return G+(F-G)*(2/3-E)*6;}return G;},hslToRGB:function(H,G,F){var J,I,E,K,L;if(G===0){J=I=E=F;}else{K=F<0.5?F*(1+G):F+G-F*G;L=2*F-K;J=C._hue2rgb(L,K,H+1/3);I=C._hue2rgb(L,K,H);E=C._hue2rgb(L,K,H-1/3);}return{r:Math.round(J*255),g:Math.round(I*255),b:Math.round(E*255)};}};D.Colors=C;function A(){A.superclass.constructor.apply(this,arguments);}A.NAME="colorpicker";A.CLASSNAME=D.ClassNameManager.getClassName(A.NAME);A.CLASSNAME_SQUARE=D.ClassNameManager.getClassName(A.NAME,"colrsqr");A.CLASSNAME_HBAR=D.ClassNameManager.getClassName(A.NAME,"hbar");A.CLASSNAME_SBAR=D.ClassNameManager.getClassName(A.NAME,"sbar");A.CLASSNAME_LBAR=D.ClassNameManager.getClassName(A.NAME,"lbar");A.CLASSNAME_SWATCH=D.ClassNameManager.getClassName(A.NAME,"swatch");A.CLASSNAME_VALUE=D.ClassNameManager.getClassName(A.NAME,"val");A.CLASSNAME_HVALUE=D.ClassNameManager.getClassName(A.NAME,"hval");A.CLASSNAME_SVALUE=D.ClassNameManager.getClassName(A.NAME,"sval");A.CLASSNAME_LVALUE=D.ClassNameManager.getClassName(A.NAME,"lval");A.CLASSNAME_RVALUE=D.ClassNameManager.getClassName(A.NAME,"rval");A.CLASSNAME_GVALUE=D.ClassNameManager.getClassName(A.NAME,"gval");A.CLASSNAME_BVALUE=D.ClassNameManager.getClassName(A.NAME,"bval");A.CLASSNAME_HEXVALUE=D.ClassNameManager.getClassName(A.NAME,"hexval");A.ATTRS={showHSLBars:{value:true},showHSL:{value:true},showRGB:{value:true},showHEX:{value:true},showSwatch:{value:true},squareWidth:{value:150},squareHeight:{value:150},barWidth:{value:20},barHeight:{value:150},swatchWidth:{value:110},swatchHeight:{value:34},hex:{getter:function(){var F=this.get("rgb"),H=F.r.toString(16),G=F.g.toString(16),E=F.b.toString(16);if(H.length<2){H="0"+H;}if(G.length<2){G="0"+G;}if(E.length<2){E="0"+E;}return H+G+E;},setter:function(K){if(K.length<6){return;}var G=K[0]+K[1],F=K[2]+K[3],H=K[4]+K[5],J=parseInt(G,16),I=parseInt(F,16),E=parseInt(H,16);this.set("rgb",{r:J,g:I,b:E});}},rgb:{getter:function(){return C.hslToRGB(this.color.h,this.color.s,this.color.l);},setter:function(F){F.r=Math.min(F.r,255);F.g=Math.min(F.g,255);F.b=Math.min(F.b,255);F.r=Math.max(F.r,0);F.g=Math.max(F.g,0);F.b=Math.max(F.b,0);var E=C.rgbToHSL(F.r,F.g,F.b);this.color=D.merge(E);this.update();}},hslInt:{getter:function(){var E=D.merge(this.color);E.h=Math.round(E.h*360);E.s=Math.round(E.s*100);E.l=Math.round(E.l*100);return E;},setter:function(F){var E=D.merge(F);E.h=E.h/360;E.s=E.s/100;E.l=E.l/100;E.h=Math.min(E.h,1);E.s=Math.min(E.s,1);E.l=Math.min(E.l,1);E.h=Math.max(E.h,0);E.s=Math.max(E.s,0);E.l=Math.max(E.l,0);this.color=E;this.update();}},hsl:{getter:function(){return this.color;},setter:function(E){E.h=Math.min(E.h,1);E.s=Math.min(E.s,1);E.l=Math.min(E.l,1);E.h=Math.max(E.h,0);E.s=Math.max(E.s,0);E.l=Math.max(E.l,0);this.color=D.merge(E);this.update();}},cacheBars:{value:false},strings:{value:{hValue:"H",sValue:"S",lValue:"L",rValue:"R",gValue:"G",bValue:"B",hexValue:"Hex"}}};D.extend(A,D.Widget,{color:{h:0,s:1,l:0.5},sCachePixels:{},lCachePixels:{},squareCachePixels:{},barPaddingX:5,barPaddingY:5,renderUI:function(){this.contentBox=this.get("contentBox");this.contentBox.addClass(this.name);this.squareCanvas=this.createCanvas(A.CLASSNAME_SQUARE,this.get("squareWidth"),this.get("squareHeight"));this.squareCanvas.id="squareCanvas";this.renderSquare();var F,H,G,E;if(this.get("showHSLBars")){F=this.get("barWidth");H=this.get("barHeight");this.hCanvas=this.createCanvas(A.CLASSNAME_HBAR,F+this.barPaddingX*2,H+this.barPaddingY*2);this.sCanvas=this.createCanvas(A.CLASSNAME_SBAR,F+this.barPaddingX*2,H+this.barPaddingY*2);this.lCanvas=this.createCanvas(A.CLASSNAME_LBAR,F+this.barPaddingX*2,H+this.barPaddingY*2);}if(this.get("showSwatch")){this.swatchCanvas=D.Node.create("<div></div>");this.swatchCanvas.addClass(A.CLASSNAME_SWATCH);this.contentBox.appendChild(this.swatchCanvas);}if(this.get("showHSL")){this.hVal=this.createValue(A.CLASSNAME_HVALUE,this.get("strings.hValue"),this.color.h,3,3,"hslInt","h");this.sVal=this.createValue(A.CLASSNAME_SVALUE,this.get("strings.sValue"),this.color.s,3,3,"hslInt","s");this.lVal=this.createValue(A.CLASSNAME_LVALUE,this.get("strings.lValue"),this.color.l,3,3,"hslInt","l");}if(this.get("showRGB")){G=this.get("rgb");this.rVal=this.createValue(A.CLASSNAME_RVALUE,this.get("strings.rValue"),G.r,3,3,"rgb","r");this.gVal=this.createValue(A.CLASSNAME_GVALUE,this.get("strings.gValue"),G.g,3,3,"rgb","g");this.bVal=this.createValue(A.CLASSNAME_BVALUE,this.get("strings.bValue"),G.b,3,3,"rgb","b");}if(this.get("showHEX")){E=this.get("hex");this.hexVal=this.createValue(A.CLASSNAME_HEXVALUE,this.get("strings.hexValue"),E,6,6,"hex",null);}},renderPixels:function(J,S,Q,V,U,Y,W,H,G,Z,X,b,a,M){var T=J.getContext("2d"),R=T.createImageData(S,Q),L={h:0,s:0,l:0},F=(b-Z)/S,K=(a-X)/Q,P=0,I=1,O,N,E;L[Y]=W;L[H]=Z;L[G]=X;if(M){I=-1;P=R.data.length;}for(N=0;N<Q;N+=1){for(O=0;O<S;O+=1){E=C.hslToRGB(L.h,L.s,L.l);R.data[P]=E.r;P+=I;R.data[P]=E.g;P+=I;R.data[P]=E.b;P+=I;R.data[P]=255;P+=I;L[H]+=F;}L[G]+=K;L[H]=Z;}T.putImageData(R,V,U);return R;},startUpdating:function(){this.stopUpdating();this.moveListener=D.on("mousemove",this.onMouseMove,this.get("boundingBox"),this);this.mouseUpListener=D.on("mouseup",this.onMouseUp,document.body,this);this.animTimer=D.later(60,this,this.update,null,true);},stopUpdating:function(){if(this.animTimer){this.animTimer.cancel();this.animTimer=null;}if(this.moveListener){this.moveListener.detach();this.moveListener=null;}if(this.mouseUpListener){this.mouseUpListener.detach();this.mouseUpListener=null;}},onBarMouseDown:function(H,F){this.trackBar=F.component;this.trackBarCanvas=H.target;
var G=H.target.getXY(),J=H.target.get("docScrollX"),I=H.target.get("docScrollY"),E=H.clientX+J-G[0],K=H.clientY+I-G[1];this.barX=E;this.barY=K;this.startUpdating();H.halt();},onMouseUp:function(E){this.trackBar=false;this.trackSquare=false;this.stopUpdating();E.halt();},onMouseMove:function(I){var F,J,H,E,M,L,K,G;if(this.trackSquare){G=D.Node.one(this.squareCanvas);F=G.getXY();L=G.get("docScrollX");K=G.get("docScrollY");J=I.clientX+L-F[0];H=I.clientY+K-F[1];E=this.get("squareWidth");M=this.get("squareHeight");J=Math.min(E,J);H=Math.min(M,H);H=Math.max(0,H);J=Math.max(0,J);this.squareX=J;this.squareY=H;}if(this.trackBar){F=this.trackBarCanvas.getXY();L=this.trackBarCanvas.get("docScrollX");K=this.trackBarCanvas.get("docScrollY");J=-this.barPaddingX+I.clientX+L-F[0];H=-this.barPaddingY+I.clientY+K-F[1];E=this.get("barWidth");M=this.get("barHeight");J=Math.min(E,J);H=Math.min(M,H);H=Math.max(0,H);J=Math.max(0,J);this.barX=J;this.barY=H;}I.halt();},onSquareMouseDown:function(G){this.trackSquare=true;var F=G.target.getXY(),I=G.target.get("docScrollX"),H=G.target.get("docScrollY"),E=G.clientX+I-F[0],J=G.clientY+H-F[1];this.squareX=E;this.squareY=J;this.startUpdating();G.halt();},updateColor:function(){if(!this.get("showHSLBars")){return;}var F=this.get("barWidth"),H=this.get("barHeight"),G=this.get("cacheBars"),E=this.hCanvas.getContext("2d");E.clearRect(0,0,F+this.barPaddingX*2,H+this.barPaddingY*2);E=this.sCanvas.getContext("2d");E.clearRect(0,0,F+this.barPaddingX*2,H+this.barPaddingY*2);E=this.lCanvas.getContext("2d");E.clearRect(0,0,F+this.barPaddingX*2,H+this.barPaddingY*2);if(G){if(!this.sCachePixels[this.color.h]){this.sCachePixels[this.color.h]=this.renderPixels(this.sCanvas,F,H,this.barPaddingX,this.barPaddingY,"h",this.color.h,"l","s",50,100,50,0);}else{E=this.sCanvas.getContext("2d");E.putImageData(this.sCachePixels[this.color.h],this.barPaddingX,this.barPaddingY);}if(!this.lCachePixels[this.color.h]){this.lCachePixels[this.color.h]=this.renderPixels(this.lCanvas,F,H,this.barPaddingX,this.barPaddingY,"h",this.color.h,"s","l",100,100,100,0);}else{E=this.lCanvas.getContext("2d");E.putImageData(this.lCachePixels[this.color.h],this.barPaddingX,this.barPaddingY);}}else{this.renderPixels(this.sCanvas,F,H,this.barPaddingX,this.barPaddingY,"h",this.color.h,"l","s",0.5,1,0.5,0);this.renderPixels(this.lCanvas,F,H,this.barPaddingX,this.barPaddingY,"h",this.color.h,"s","l",1,1,1,0);}if(!this.huePixelCache){this.huePixelCache=this.renderPixels(this.hCanvas,F,H,this.barPaddingX,this.barPaddingY,"s",1,"l","h",0.5,0,0.5,1);}else{E=this.hCanvas.getContext("2d");E.putImageData(this.huePixelCache,this.barPaddingX,this.barPaddingY);}},drawThumb:function(F,L,H,E,O,M,I){var N=this.color[L],P=F.getContext("2d"),K=(O/M)*(N),G=H,J;if(I){K=O-K;}K+=this.barPaddingY;G[L]=N;G.h=G.h-0.5;if(G.h<0){G.h+=1;}G.s=G.s-0.5;if(G.s<0){G.s+=1;}G.l=G.l-0.5;if(G.l<0){G.l+=1;}P.beginPath();P.moveTo(this.barPaddingX,K);P.lineTo(E+this.barPaddingX*2,K);J=C.hslToRGB(G.h,G.s,G.l);P.strokeStyle="rgb("+J.r+", "+J.g+", "+J.b+")";P.lineWidth=0.5;P.stroke();P.beginPath();P.moveTo(this.barPaddingX,K);P.lineTo(0,K-2.5);P.lineTo(0,K+2.5);P.lineTo(this.barPaddingX,K);P.moveTo(E+this.barPaddingX,K);P.lineTo(E+this.barPaddingX*2,K-2.5);P.lineTo(E+this.barPaddingX*2,K+2.5);P.lineTo(E+this.barPaddingX,K);P.strokeStyle="rgb(255, 255, 255)";P.fillStyle="rgb(255, 255, 255)";P.stroke();P.fill();},updateValues:function(){var E=this.get("rgb"),F;if(this.get("showSwatch")){this.swatchCanvas.setStyle("background","rgb("+E.r+", "+E.g+", "+E.b+")");}if(this.get("showHSL")){this.hVal.set("value",Math.round(this.color.h*360));this.sVal.set("value",Math.round(this.color.s*100));this.lVal.set("value",Math.round(this.color.l*100));}if(this.get("showRGB")){this.rVal.set("value",E.r);this.gVal.set("value",E.g);this.bVal.set("value",E.b);}if(this.get("showHEX")){F=this.get("hex");this.hexVal.set("value",F);}},update:function(){var J=this.get("squareWidth"),E=this.get("squareHeight"),I=this.get("barWidth"),K=this.get("barHeight"),H,F,G;if(this.trackSquare){H=(1/J)*this.squareX;F=1-(1/E)*this.squareY;this.color.h=H;this.color.l=F;}if(this.trackBar){if(this.trackBar==="h"){H=(1/K)*this.barY;this.color.h=H;}else{G=1-(1/K)*this.barY;this.color[this.trackBar]=G;}}this.renderSquare();this.updateValues();if(this.get("showHSLBars")){this.updateColor();this.drawThumb(this.hCanvas,"h",{h:this.color.h,s:1,l:0.5},I,K,1,false);this.drawThumb(this.sCanvas,"s",{h:this.color.h,s:1,l:this.color.l},I,K,1,true);this.drawThumb(this.lCanvas,"l",{h:this.color.h,s:this.color.s,l:0.5},I,K,1,true);}},renderSquare:function(){var I=this.get("squareWidth"),G=this.get("squareHeight"),H=this.squareCanvas.getContext("2d"),F,E,J;if(!this.squareCachePixels[this.color.s]){this.squareCachePixels[this.color.s]=this.renderPixels(this.squareCanvas,I,G,0,0,"s",this.color.s,"h","l",0,1,1,0);}else{H.putImageData(this.squareCachePixels[this.color.s],0,0);}H.strokeStyle="rgb(255, 255, 255)";F=5;E=(this.color.h*(I/1));J=((1-this.color.l)*(G/1));H.beginPath();H.arc(E,J,F,0,Math.PI*2,true);H.stroke();H.beginPath();H.strokeStyle="rgb(0, 0, 0)";H.arc(E,J,F+1,0,Math.PI*2,true);H.stroke();},createCanvas:function(H,G,E){var I=D.Node.create("<div class='"+H+"'></div>"),F=D.Node.create("<canvas width='"+G+"' height='"+E+"'></canvas>");I.appendChild(F);this.contentBox.appendChild(I);return D.Node.getDOMNode(F);},createValue:function(H,K,L,M,F,G,I){var E=D.Node.create("<div class='"+A.CLASSNAME_VALUE+" "+H+"'></div>"),J=D.Node.create("<input type='text' size='"+M+"' maxlength='"+F+"' value='"+L+"'></input>");K=D.Node.create("<label>"+K+"</label>");E.appendChild(K);K.appendChild(J);this.contentBox.appendChild(E);J.setData("target",G);J.setData("component",I);return J;},onInputKeyDown:function(H){if(H.charCode===13||H.charCode===8||H.charCode===127||H.charCode===9){return true;}var F=String.fromCharCode(H.charCode),E=H.target,I=E.getData("target"),G;if(I==="hex"){G=/[0-9]|[a-f]|[A-F]/;if(!G.test(F)){H.halt();return false;
}}else{G=/[0-9]/;if(!G.test(F)){H.halt();return false;}}},onInputKeyUp:function(H){var F=H.target,J=F.getData("target"),G=F.getData("component"),E=F.get("value"),I;if(E===""){return;}if(J==="hex"){if(E.length<6){return;}this.set(J,E);return;}I=this.get(J);I[G]=parseInt(E,10);this.set(J,I);},onInputBlur:function(){this.update();},bindUI:function(){D.on("mousedown",this.onSquareMouseDown,this.squareCanvas,this);if(this.get("showHSLBars")){D.on("mousedown",this.onBarMouseDown,this.hCanvas,this,{component:"h"});D.on("mousedown",this.onBarMouseDown,this.sCanvas,this,{component:"s"});D.on("mousedown",this.onBarMouseDown,this.lCanvas,this,{component:"l"});}D.delegate("keyup",this.onInputKeyUp,this.contentBox,"."+A.CLASSNAME_VALUE,this);D.delegate("blur",this.onInputBlur,this.contentBox,"."+A.CLASSNAME_VALUE,this);D.delegate("keydown",this.onInputKeyDown,this.contentBox,"."+A.CLASSNAME_VALUE,this);},syncUI:function(){var F=this.get("squareWidth"),E=this.get("squareHeight");this.squareX=this.color.h*(F/1);this.squareY=this.color.l*(E/1);this.update();}});D.ColorPicker=A;function B(){B.superclass.constructor.apply(this,arguments);this.publish("palette:selected");}B.NAME="colorPalette";B.CLASSNAME_SWATCH="cp-swatch";B.ATTRS={};D.extend(B,D.Widget,{colors:[],colorExists:function(E){var F,G;for(F=0;F<this.colors.length;F+=1){G=this.colors[F];if(G.h===E.h&&G.s===E.s&&G.l===E.l){return true;}}return false;},addColor:function(F){if(this.colorExists(F)){return;}var H=D.merge(F),I=D.Node.create('<div class="'+B.CLASSNAME_SWATCH+'"></div>'),G=C.hslToRGB(H.h,H.s,H.l),E=this.get("contentBox");I.setStyle("background","rgb("+G.r+", "+G.g+", "+G.b+")");I.setData("hsl",H);E.appendChild(I);this.colors.push(H);},renderUI:function(){},bindUI:function(){D.delegate("click",this.onSwatchClick,this.get("contentBox"),"."+B.CLASSNAME_SWATCH,this);},onSwatchClick:function(H){var G=H.target,E=G.getData("hsl"),F=C.hslToRGB(E.h,E.s,E.l);this.fire("palette:selected",{hsl:E,rgb:F});},syncUI:function(){}});D.ColorPalette=B;},"@VERSION@",{requires:["node","event","widget","classnamemanager"]});